<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jianing Yao">

<title>Jianing Yao - Example analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Jianing Yao</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./analysis.html" rel="" target="" aria-current="page">
 <span class="menu-text">Example analysis</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#question" id="toc-question" class="nav-link" data-scroll-target="#question">Question</a></li>
  <li><a href="#audience" id="toc-audience" class="nav-link" data-scroll-target="#audience">Audience</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a></li>
  <li><a href="#results-and-summary" id="toc-results-and-summary" class="nav-link" data-scroll-target="#results-and-summary">Results and Summary</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Example analysis</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jianing Yao </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>Healthcare costs for employed women in the United States are estimated to be $15 billion greater than for employed men from the age of 19 to 64 in 2023, according to research by Deloitte <span class="citation" data-cites="Deloitte">(<a href="#ref-Deloitte" role="doc-biblioref"><em>Closing the Benefit Gap to Advance Womenâ€™s Health Equity</em> 2023</a>)</span>. This economic strain contributes to the existing pay gap between genders and continues even when services related to maternity are not considered. What about elderly people above 65 years old who are more likely to face severe and chronic diseases? Will the disparity persist, or even exaggerate, for older man and women?</p>
<div id="fig:healthcareCost" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/healthcare_cost.jpeg" class="img-fluid figure-img" width="500"></p>
<figcaption class="figure-caption">Figure 1: Healthcare benefit gap in 2023</figcaption>
</figure>
</div>
</section>
<section id="question" class="level3">
<h3 class="anchored" data-anchor-id="question">Question</h3>
<p>For this analysis, I am interested in the question of whether older (at least 65 years of age) men and women of the same age use roughly the same quantity of medical services measured by their annual medical expenditures.</p>
</section>
<section id="audience" class="level3">
<h3 class="anchored" data-anchor-id="audience">Audience</h3>
<p>This analysis can help healthcare policymakes to better understand how medical needs and expenses differ by gender among the elderly so that they can tailor more effective and equitable healthcare policies.</p>
</section>
<section id="dataset" class="level3">
<h3 class="anchored" data-anchor-id="dataset">Dataset</h3>
<p>The data of annual medical expenditures for men and women from 65 to 95 years of age were obtained and adjusted from the <a href="https://wonder.cdc.gov/wonder/sci_data/surveys/nmes/nmes.asp">1987 National Medical Expenditure Survey</a> <span class="citation" data-cites="NMES">(<a href="#ref-NMES" role="doc-biblioref"><em>Scientific Data NMES</em> 2016</a>)</span>. To answer the research question above, I used three variables extracted from the data set: participantâ€™s age (<em>lastage</em>), gender (<em>female</em>), and total health care expenditures (<em>totalexp</em>). A full list of data dictionary can be found <a href="https://wonder.cdc.gov/wonder/sci_data/surveys/nmes/type_txt/puf18.asp">here</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The data and analysis are adopted from homework of Methods in Biostatistics.</p>
</div>
</div>
</section>
<section id="analysis" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="analysis">Analysis</h3>
<section id="step-0-data-set-preparation." class="level4">
<h4 class="anchored" data-anchor-id="step-0-data-set-preparation.">Step 0: data set preparation.</h4>
<p><strong>Select variables of interest (i.e., age, gender, medical expenditures) and create variables for linear spline with knots at 75 and 85 years of age.</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/nmes.rdata"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> nmes <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">names</span>(.)[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">15</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(., lastage<span class="sc">&gt;=</span><span class="dv">65</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agem65 =</span> lastage <span class="sc">-</span> <span class="dv">65</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_sp1 =</span> <span class="fu">ifelse</span>(lastage<span class="dv">-75</span><span class="sc">&gt;</span><span class="dv">0</span>, lastage <span class="sc">-</span> <span class="dv">75</span>, <span class="dv">0</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_sp2 =</span> <span class="fu">ifelse</span>(lastage<span class="dv">-85</span><span class="sc">&gt;</span><span class="dv">0</span>, lastage <span class="sc">-</span> <span class="dv">85</span>, <span class="dv">0</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">Gender =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(male <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>Gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>Gender,<span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Male"</span>,<span class="st">"Female"</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[<span class="fu">complete.cases</span>(d),]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[<span class="fu">order</span>(d<span class="sc">$</span>lastage),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-1-exploratory-analysis" class="level4">
<h4 class="anchored" data-anchor-id="step-1-exploratory-analysis">Step 1: exploratory analysis</h4>
<p><strong>Compute mean and standard deviation for age and medical expenditures for female and male.</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>summary <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_age =</span> <span class="fu">mean</span>(lastage), </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_age =</span> <span class="fu">sd</span>(lastage),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_exp =</span> <span class="fu">mean</span>(totalexp),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_exp =</span> <span class="fu">sd</span>(totalexp)) <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(summary) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Gender'</span>, <span class="st">'Age mean'</span>, <span class="st">'Age sd'</span>, <span class="st">'Expenditure mean'</span>, <span class="st">'Expenditure sd'</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> <span class="fu">kable</span>(summary, <span class="at">format =</span> <span class="st">"html"</span>, <span class="at">table.attr =</span> <span class="st">"class='table table-striped'"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>summary_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Gender</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Age mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Age sd</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Expenditure mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Expenditure sd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Male</td>
<td style="text-align: right;">73.36447</td>
<td style="text-align: right;">6.318776</td>
<td style="text-align: right;">4468.722</td>
<td style="text-align: right;">10951.53</td>
</tr>
<tr class="even">
<td style="text-align: left;">Female</td>
<td style="text-align: right;">74.04232</td>
<td style="text-align: right;">6.794712</td>
<td style="text-align: right;">4366.424</td>
<td style="text-align: right;">10327.56</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> lastage, <span class="at">y =</span> totalexp <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">color =</span> Gender)) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Gender) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (in years)"</span>, <span class="at">y =</span> <span class="st">"Medical Expenditure (in $1000s)"</span>, <span class="at">title =</span> <span class="st">"Medical Expenditures (in $1000s) by Gender"</span>) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">200</span>,<span class="dv">20</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">65</span>,<span class="dv">95</span>,<span class="dv">5</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">65</span>,<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="analysis_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 2: Medical expenditures in thousands of dollars by gender for participants above 65 years old.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="step-2-linear-regression-model-with-age-and-gender" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="step-2-linear-regression-model-with-age-and-gender">Step 2: linear regression model with age and gender</h4>
<p><strong>First, we fit a full linear regression model with age, linear splines with knots at 75 and 85 years of age, gender, and interactions between predictors.</strong></p>
<p>General MLR model:</p>
<p><span class="math display">\[
\begin{align*}
Y_i = &amp; \ \beta_0 + \beta_1(age_i-65) + \beta_2(age_i-75)^+ + \beta_3(age_i-85)^+ \\
      &amp; + \beta_4\text{female}_i + \beta_5\text{female}_i \cdot (age_i-65) \\
      &amp; + \beta_6\text{female}_i \cdot (age_i-75)^+ + \beta_7\text{female}_i \cdot (age_i-85)^+ + \epsilon_i \text{ , } \\
      &amp; \ \text{where } \epsilon_i \sim N(0, \sigma^2)
\end{align*}
\]</span></p>
<div class="callout callout-style-default callout-caution callout-titled" title="Model Assumption">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Model Assumption
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that constant variance (homoscedasticity) is assumed in this linear regression model.</p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>mlr.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(totalexp <span class="sc">~</span> (agem65 <span class="sc">+</span> age_sp1 <span class="sc">+</span> age_sp2) <span class="sc">+</span> Gender <span class="sc">+</span> Gender<span class="sc">*</span>(agem65 <span class="sc">+</span> age_sp1 <span class="sc">+</span> age_sp2), <span class="at">data =</span> d)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>tidy_mlr.fit <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mlr.fit)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>tidy_mlr.fit <span class="ot">&lt;-</span> tidy_mlr.fit[, <span class="fu">c</span>(<span class="st">"term"</span>, <span class="st">"estimate"</span>, <span class="st">"std.error"</span>, <span class="st">"statistic"</span>, <span class="st">"p.value"</span>)]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tidy_mlr.fit, <span class="at">caption =</span> <span class="st">"Linear model coefficients of the full model"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">format =</span> <span class="st">"html"</span>, </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Term"</span>, <span class="st">"Estimate"</span>, <span class="st">"Std. Error"</span>, <span class="st">"t value"</span>, <span class="st">"Pr(&gt;|t|)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Linear model coefficients of the full model</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">t value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">4159.387</td>
<td style="text-align: right;">473.406</td>
<td style="text-align: right;">8.786</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">agem65</td>
<td style="text-align: right;">11.857</td>
<td style="text-align: right;">75.829</td>
<td style="text-align: right;">0.156</td>
<td style="text-align: right;">0.876</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_sp1</td>
<td style="text-align: right;">132.811</td>
<td style="text-align: right;">153.871</td>
<td style="text-align: right;">0.863</td>
<td style="text-align: right;">0.388</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_sp2</td>
<td style="text-align: right;">-254.602</td>
<td style="text-align: right;">327.083</td>
<td style="text-align: right;">-0.778</td>
<td style="text-align: right;">0.436</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GenderFemale</td>
<td style="text-align: right;">-974.517</td>
<td style="text-align: right;">614.701</td>
<td style="text-align: right;">-1.585</td>
<td style="text-align: right;">0.113</td>
</tr>
<tr class="even">
<td style="text-align: left;">agem65:GenderFemale</td>
<td style="text-align: right;">117.222</td>
<td style="text-align: right;">98.182</td>
<td style="text-align: right;">1.194</td>
<td style="text-align: right;">0.233</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_sp1:GenderFemale</td>
<td style="text-align: right;">-154.604</td>
<td style="text-align: right;">197.009</td>
<td style="text-align: right;">-0.785</td>
<td style="text-align: right;">0.433</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_sp2:GenderFemale</td>
<td style="text-align: right;">512.462</td>
<td style="text-align: right;">406.299</td>
<td style="text-align: right;">1.261</td>
<td style="text-align: right;">0.207</td>
</tr>
</tbody>
</table>


</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<ul>
<li><code>agem65</code>: age after centered at 65</li>
<li><code>age_sp1</code>: the number of years if a person is over 75; if not, age_sp1 = 0</li>
<li><code>age_sp2</code>: the number of years if a person is over 85; if not, age_sp2 = 0</li>
<li><code>GenderFemale</code>: indicator of female</li>
</ul>
</div></div><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>observed_y <span class="ot">=</span> d<span class="sc">$</span>totalexp <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>predicted_y <span class="ot">=</span> mlr.fit<span class="sc">$</span>fitted.values <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> lastage, <span class="at">y =</span> observed_y, <span class="at">color=</span>Gender)) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span> <span class="co"># use jittered points for better visualization </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> lastage, <span class="at">y =</span> predicted_y)) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">200</span>,<span class="dv">20</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">65</span>,<span class="dv">95</span>,<span class="dv">5</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">65</span>,<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (in years)"</span>, <span class="at">y =</span> <span class="st">"Medical Expenditure (in $1000s)"</span>, <span class="at">title =</span> <span class="st">"Medical Expenditures (in $1000s) by Age and Gender with fitted line"</span>) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="analysis_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 3: Medical expenditures in thousands of dollars by gender for participants above 65 years old, with the fitted lines estimated from the full linear regression model.</figcaption>
</figure>
</div>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p><code>geom_jitter</code> to plot jittered points for better visualization</p>
</div></div><p><strong>Zoom in on the plot to show the average medical expenditures for females and males across age.</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> lastage, <span class="at">y =</span> observed_y, <span class="at">color=</span>Gender)) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> lastage, <span class="at">y =</span> predicted_y)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">5</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">65</span>,<span class="dv">95</span>,<span class="dv">5</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">65</span>,<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (in years)"</span>, <span class="at">y =</span> <span class="st">"Medical Expenditure (in $1000s)"</span>, <span class="at">title =</span> <span class="st">"Medical Expenditures (in $1000s) by Age and Gender with fitted line"</span>) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="analysis_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 4: Zoomed in plot of medical expenditures in thousands of dollars by gender for participants above 65 years old, with the fitted lines estimated from the full linear regression model.</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Plot expected difference between women and men in expenditures as a function of age.</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>age <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">65</span>,<span class="dv">95</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>agesp1 <span class="ot">=</span> <span class="fu">ifelse</span>(age<span class="sc">&gt;=</span><span class="dv">75</span>,age<span class="dv">-75</span>,<span class="dv">0</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>agesp2 <span class="ot">=</span> <span class="fu">ifelse</span>(age<span class="sc">&gt;=</span><span class="dv">85</span>,age<span class="dv">-85</span>,<span class="dv">0</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>age65 <span class="ot">=</span> age<span class="dv">-65</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>AGE <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">31</span>),age65,agesp1,agesp2)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>expectDiff<span class="ot">=</span><span class="fu">t</span>(AGE)<span class="sc">%*%</span><span class="fu">coefficients</span>(mlr.fit)[<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>V <span class="ot">=</span> <span class="fu">vcov</span>(mlr.fit)[<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>V.big <span class="ot">=</span> <span class="fu">t</span>(AGE)<span class="sc">%*%</span>V<span class="sc">%*%</span>AGE</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>var <span class="ot">=</span> <span class="fu">diag</span>(V.big)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>diffage <span class="ot">=</span> <span class="fu">data.frame</span>(age,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">expectDiff =</span> expectDiff<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">std =</span> <span class="fu">sqrt</span>(var),</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">min =</span> (expectDiff<span class="fl">-1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(var))<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">max =</span>(expectDiff<span class="fl">+1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(var))<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diffage,<span class="fu">aes</span>(<span class="at">x =</span> age,<span class="at">y =</span> expectDiff)) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> diffage) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,<span class="at">col =</span> <span class="st">'blue'</span>,<span class="at">data=</span> diffage, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>min,<span class="at">ymax =</span>max),<span class="at">alpha =</span><span class="fl">0.5</span>,<span class="at">data=</span> diffage) <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">12</span>,<span class="dv">1</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">65</span>,<span class="dv">95</span>,<span class="dv">5</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">65</span>,<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Difference (Female - Male, in $1000s)"</span>, <span class="at">x =</span> <span class="st">"Age (in years)"</span>) <span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="analysis_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 5: Expected difference between women and men in medical expenditures as a function of age. The dotted line indicates no difference. 95% confidence interval is illustrated in the shaded region.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="step-3-linear-regression-model-with-age" class="level4">
<h4 class="anchored" data-anchor-id="step-3-linear-regression-model-with-age">Step 3: linear regression model with age</h4>
<p><strong>Further, we want to test the null hypothesis that on average, males and females use the same quantity of medical services; i.e.&nbsp;are the mean expenditures at any age the same for males and females?</strong></p>
<p><span class="math display">\[
\begin{align*}
H_0: &amp; \ \beta_4 = \beta_5 = \beta_6 = \beta_7 = 0 \\
H_a: &amp; \ \text{at least one of } \beta_4, \beta_5, \beta_6, \text{ or } \beta_7 \text{ is not zero.}
\end{align*}
\]</span></p>
<p><strong>We can fit a reduced a model with only age-related predictors:</strong></p>
<p><span class="math display">\[
\begin{align*}
Y_i = &amp; \ \beta_0 + \beta_1(age_i-65) + \beta_2(age_i-75)^+ + \beta_3(age_i-85)^+ + \epsilon_i \text{ , } \\
      &amp; \ \text{where } \epsilon_i \sim N(0, \sigma^2)
\end{align*}
\]</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mlr.fit0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(totalexp <span class="sc">~</span> agem65 <span class="sc">+</span> age_sp1 <span class="sc">+</span> age_sp2, <span class="at">data =</span> d)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>tidy_mlr.fit0 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mlr.fit0)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>tidy_mlr.fit0 <span class="ot">&lt;-</span> tidy_mlr.fit0[, <span class="fu">c</span>(<span class="st">"term"</span>, <span class="st">"estimate"</span>, <span class="st">"std.error"</span>, <span class="st">"statistic"</span>, <span class="st">"p.value"</span>)]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tidy_mlr.fit0, <span class="at">caption =</span> <span class="st">"Linear model coefficients of the reduced model"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">format =</span> <span class="st">"html"</span>, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Term"</span>, <span class="st">"Estimate"</span>, <span class="st">"Std. Error"</span>, <span class="st">"t value"</span>, <span class="st">"Pr(&gt;|t|)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F, <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Linear model coefficients of the reduced model</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">t value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">3582.732</td>
<td style="text-align: right;">301.979</td>
<td style="text-align: right;">11.864</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">agem65</td>
<td style="text-align: right;">81.695</td>
<td style="text-align: right;">48.169</td>
<td style="text-align: right;">1.696</td>
<td style="text-align: right;">0.090</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_sp1</td>
<td style="text-align: right;">40.248</td>
<td style="text-align: right;">95.995</td>
<td style="text-align: right;">0.419</td>
<td style="text-align: right;">0.675</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_sp2</td>
<td style="text-align: right;">85.352</td>
<td style="text-align: right;">193.851</td>
<td style="text-align: right;">0.440</td>
<td style="text-align: right;">0.660</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># likelihood ratio test</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(mlr.fit0, mlr.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: totalexp ~ agem65 + age_sp1 + age_sp2
Model 2: totalexp ~ (agem65 + age_sp1 + age_sp2) + Gender + Gender * (agem65 + 
    age_sp1 + age_sp2)
  #Df LogLik Df Chisq Pr(&gt;Chisq)
1   5 -60831                    
2   9 -60828  4 5.158     0.2715</code></pre>
</div>
</div>
<p><strong>A likelihood ratio test showed that the reduced model and the full model are not significantly different from each other (<span class="math inline">\(p=0.2715\)</span>), indicating we fail to reject the null hypothesis and that the mean expenditures at any age are the same for males and females.</strong></p>
</section>
</section>
<section id="results-and-summary" class="level3">
<h3 class="anchored" data-anchor-id="results-and-summary">Results and Summary</h3>
<p>In this example analysis, we utilized the data from 1987 National Medical Expenditure Survey (NMES) to examine the annual change of total medical expenditure for older people (from age 65 to 94) and its relationship with sex. We first fitted a linear spline regression model on total medical expenditure with age and sex and the interaction between the two factors. The regression result showed that none of the predictors of age and sex were significant except for the intercept, even though the scatter plot indicated some disparity between male and female at age 65 - 75 and above 85 (Figure 4). The 95% confidence interval for estimated difference in average expenditures comparing men and women as a function of age suggested no significant difference due to sex (Figure 5). We performed a likelihood ratio test to compare the full model with a reduced model excluding the factor sex and concluded that we failed to reject the null hypothesis that men and women have the same quantity of medical expenditures at any age.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>This analysis is based on the assumption that residuals are normally distributed and homoscedastic, which requires further validation. If such assumptions are violated, standard errors and confidence intervals are likely biased, and a more appropriate analysis approach need to be adapted.</p>
</div>
</div>
</div>
<p>However, more recent analyses indeed demonstrated noticeable discrepancy between female and male in healthcare expenses. The Kaiser Family Foundation analysis of CMS Medicare Current Beneficiary Survey 2009 Cost and Use file <span class="citation" data-cites="KFF">(<a href="#ref-KFF" role="doc-biblioref"><em>Medicareâ€™s Role for Older Women</em> 2019</a>)</span> showed that out-of-pocket spending by elder female is higher than that by male while more proportion of women had annual incomes below $20,000 compared to men (Figure 6). Thus, it is important for health policymakers to consider various factors regarding medical expenditures, such as socioeconomic status and etc., before coming to any conclusions.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/healthcare_2009.webp" class="img-fluid figure-img" width="500"></p>
<figcaption class="figure-caption">Figure 6: Income and out-of-pocket expenses among older medicare beneficiaries, by gender and age</figcaption>
</figure>
</div>
</section>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<ul>
<li><code>dplyr</code>: <code>select()</code>, <code>filter()</code>, <code>mutate()</code>, <code>group_by()</code>,<code>summarise()</code></li>
<li><code>ggplot2</code>: <code>geom_point()</code>, <code>geom_jitter</code>, <code>geom_line</code>, <code>geom_hline</code>, <code>geom_ribbon</code></li>
</ul>
<div id="bibliography">

</div>


<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Deloitte" class="csl-entry" role="listitem">
<em>Closing the Benefit Gap to Advance Womenâ€™s Health Equity</em>. 2023. Deloitte United States. <a href="https://www2.deloitte.com/us/en/pages/life-sciences-and-health-care/articles/womens-health-equity-disparities.html?utm_source=newsletter&amp;utm_medium=email&amp;utm_campaign=newsletter_axiosvitals&amp;stream=top">https://www2.deloitte.com/us/en/pages/life-sciences-and-health-care/articles/womens-health-equity-disparities.html?utm_source=newsletter&amp;utm_medium=email&amp;utm_campaign=newsletter_axiosvitals&amp;stream=top</a>.
</div>
<div id="ref-KFF" class="csl-entry" role="listitem">
<em>Medicareâ€™s Role for Older Women</em>. 2019. KFF. <a href="https://www.kff.org/womens-health-policy/fact-sheet/medicares-role-for-older-women/">https://www.kff.org/womens-health-policy/fact-sheet/medicares-role-for-older-women/</a>.
</div>
<div id="ref-NMES" class="csl-entry" role="listitem">
<em>Scientific Data NMES</em>. 2016. <span>Centers for Disease Control and Prevention</span>. <a href="https://wonder.cdc.gov/wonder/sci_data/surveys/nmes/nmes.asp">https://wonder.cdc.gov/wonder/sci_data/surveys/nmes/nmes.asp</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb11" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Example analysis"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Jianing Yao"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> reference.bib</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show me code"</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles.css</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">### Background</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>Healthcare costs for employed women in the United States are estimated to be \$15 billion greater than for employed men from the age of 19 to 64 in 2023, according to research by Deloitte <span class="co">[</span><span class="ot">@Deloitte</span><span class="co">]</span>. This economic strain contributes to the existing pay gap between genders and continues even when services related to maternity are not considered. What about elderly people above 65 years old who are more likely to face severe and chronic diseases? Will the disparity persist, or even exaggerate, for older man and women?</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="al">![Figure 1: Healthcare benefit gap in 2023](images/healthcare_cost.jpeg)</span>{#fig:healthcareCost width="500px" fig-cap="Figure 1: Healthcare spending summary in 2023"}</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>For this analysis, I am interested in the question of whether older (at least 65 years of age) men and women of the same age use roughly the same quantity of medical services measured by their annual medical expenditures.</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="fu">### Audience</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>This analysis can help healthcare policymakes to better understand how medical needs and expenses differ by gender among the elderly so that they can tailor more effective and equitable healthcare policies.</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dataset</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>The data of annual medical expenditures for men and women from 65 to 95 years of age were obtained and adjusted from the <span class="co">[</span><span class="ot">1987 National Medical Expenditure Survey</span><span class="co">](https://wonder.cdc.gov/wonder/sci_data/surveys/nmes/nmes.asp)</span> <span class="co">[</span><span class="ot">@NMES</span><span class="co">]</span>. To answer the research question above, I used three variables extracted from the data set: participant's age (*lastage*), gender (*female*), and total health care expenditures (*totalexp*). A full list of data dictionary can be found <span class="co">[</span><span class="ot">here</span><span class="co">](https://wonder.cdc.gov/wonder/sci_data/surveys/nmes/type_txt/puf18.asp)</span>.</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>The data and analysis are adopted from homework of Methods in Biostatistics.</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analysis</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 0: data set preparation.</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>**Select variables of interest (i.e., age, gender, medical expenditures) and create variables for linear spline with knots at 75 and 85 years of age.**</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./data/nmes.rdata"</span>)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> nmes <span class="sc">%&gt;%</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">names</span>(.)[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">15</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(., lastage<span class="sc">&gt;=</span><span class="dv">65</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agem65 =</span> lastage <span class="sc">-</span> <span class="dv">65</span>,</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_sp1 =</span> <span class="fu">ifelse</span>(lastage<span class="dv">-75</span><span class="sc">&gt;</span><span class="dv">0</span>, lastage <span class="sc">-</span> <span class="dv">75</span>, <span class="dv">0</span>),</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_sp2 =</span> <span class="fu">ifelse</span>(lastage<span class="dv">-85</span><span class="sc">&gt;</span><span class="dv">0</span>, lastage <span class="sc">-</span> <span class="dv">85</span>, <span class="dv">0</span>),</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">Gender =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(male <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>Gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>Gender,<span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Male"</span>,<span class="st">"Female"</span>))</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[<span class="fu">complete.cases</span>(d),]</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[<span class="fu">order</span>(d<span class="sc">$</span>lastage),]</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 1: exploratory analysis</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>**Compute mean and standard deviation for age and medical expenditures for female and male.**</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>summary <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender) <span class="sc">%&gt;%</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_age =</span> <span class="fu">mean</span>(lastage), </span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_age =</span> <span class="fu">sd</span>(lastage),</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_exp =</span> <span class="fu">mean</span>(totalexp),</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_exp =</span> <span class="fu">sd</span>(totalexp)) <span class="sc">%&gt;%</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(summary) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Gender'</span>, <span class="st">'Age mean'</span>, <span class="st">'Age sd'</span>, <span class="st">'Expenditure mean'</span>, <span class="st">'Expenditure sd'</span>)</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> <span class="fu">kable</span>(summary, <span class="at">format =</span> <span class="st">"html"</span>, <span class="at">table.attr =</span> <span class="st">"class='table table-striped'"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>))</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>summary_table</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.cap="Figure 2: Medical expenditures in thousands of dollars by gender for participants above 65 years old."}</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> lastage, <span class="at">y =</span> totalexp <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">color =</span> Gender)) <span class="sc">+</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Gender) <span class="sc">+</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (in years)"</span>, <span class="at">y =</span> <span class="st">"Medical Expenditure (in $1000s)"</span>, <span class="at">title =</span> <span class="st">"Medical Expenditures (in $1000s) by Gender"</span>) <span class="sc">+</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">200</span>,<span class="dv">20</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">65</span>,<span class="dv">95</span>,<span class="dv">5</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">65</span>,<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 2: linear regression model with age and gender</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>**First, we fit a full linear regression model with age, linear splines with knots at 75 and 85 years of age, gender, and interactions between predictors.**</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>General MLR model:</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>Y_i = &amp; \ \beta_0 + \beta_1(age_i-65) + \beta_2(age_i-75)^+ + \beta_3(age_i-85)^+ <span class="sc">\\</span></span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>      &amp; + \beta_4\text{female}_i + \beta_5\text{female}_i \cdot (age_i-65) <span class="sc">\\</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>      &amp; + \beta_6\text{female}_i \cdot (age_i-75)^+ + \beta_7\text{female}_i \cdot (age_i-85)^+ + \epsilon_i \text{ , } <span class="sc">\\</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>      &amp; \ \text{where } \epsilon_i \sim N(0, \sigma^2)</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>::: {.callout-caution title="Model Assumption"}</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>Note that constant variance (homoscedasticity) is assumed in this linear regression model.</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>mlr.fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(totalexp <span class="sc">~</span> (agem65 <span class="sc">+</span> age_sp1 <span class="sc">+</span> age_sp2) <span class="sc">+</span> Gender <span class="sc">+</span> Gender<span class="sc">*</span>(agem65 <span class="sc">+</span> age_sp1 <span class="sc">+</span> age_sp2), <span class="at">data =</span> d)</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>tidy_mlr.fit <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mlr.fit)</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>tidy_mlr.fit <span class="ot">&lt;-</span> tidy_mlr.fit[, <span class="fu">c</span>(<span class="st">"term"</span>, <span class="st">"estimate"</span>, <span class="st">"std.error"</span>, <span class="st">"statistic"</span>, <span class="st">"p.value"</span>)]</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tidy_mlr.fit, <span class="at">caption =</span> <span class="st">"Linear model coefficients of the full model"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">format =</span> <span class="st">"html"</span>, </span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Term"</span>, <span class="st">"Estimate"</span>, <span class="st">"Std. Error"</span>, <span class="st">"t value"</span>, <span class="st">"Pr(&gt;|t|)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F, <span class="at">position =</span> <span class="st">"left"</span>)</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>::: column-margin</span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`agem65`</span>: age after centered at 65</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`age_sp1`</span>: the number of years if a person is over 75; if not, age_sp1 = 0</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`age_sp2`</span>: the number of years if a person is over 85; if not, age_sp2 = 0</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`GenderFemale`</span>: indicator of female</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.cap="Figure 3: Medical expenditures in thousands of dollars by gender for participants above 65 years old, with the fitted lines estimated from the full linear regression model.", warning=FALSE}</span></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>observed_y <span class="ot">=</span> d<span class="sc">$</span>totalexp <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>predicted_y <span class="ot">=</span> mlr.fit<span class="sc">$</span>fitted.values <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> lastage, <span class="at">y =</span> observed_y, <span class="at">color=</span>Gender)) <span class="sc">+</span></span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span> <span class="co"># use jittered points for better visualization </span></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> lastage, <span class="at">y =</span> predicted_y)) <span class="sc">+</span></span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">200</span>,<span class="dv">20</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">65</span>,<span class="dv">95</span>,<span class="dv">5</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">65</span>,<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (in years)"</span>, <span class="at">y =</span> <span class="st">"Medical Expenditure (in $1000s)"</span>, <span class="at">title =</span> <span class="st">"Medical Expenditures (in $1000s) by Age and Gender with fitted line"</span>) <span class="sc">+</span></span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>::: column-margin</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_jitter`</span> to plot jittered points for better visualization</span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>**Zoom in on the plot to show the average medical expenditures for females and males across age.**</span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.cap="Figure 4: Zoomed in plot of medical expenditures in thousands of dollars by gender for participants above 65 years old, with the fitted lines estimated from the full linear regression model.", warning=FALSE}</span></span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> lastage, <span class="at">y =</span> observed_y, <span class="at">color=</span>Gender)) <span class="sc">+</span></span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> lastage, <span class="at">y =</span> predicted_y)) <span class="sc">+</span></span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">5</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">65</span>,<span class="dv">95</span>,<span class="dv">5</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">65</span>,<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (in years)"</span>, <span class="at">y =</span> <span class="st">"Medical Expenditure (in $1000s)"</span>, <span class="at">title =</span> <span class="st">"Medical Expenditures (in $1000s) by Age and Gender with fitted line"</span>) <span class="sc">+</span></span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>**Plot expected difference between women and men in expenditures as a function of age.**</span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.cap="Figure 5: Expected difference between women and men in medical expenditures as a function of age. The dotted line indicates no difference. 95% confidence interval is illustrated in the shaded region.", warning=FALSE}</span></span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>age <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">65</span>,<span class="dv">95</span>)</span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>agesp1 <span class="ot">=</span> <span class="fu">ifelse</span>(age<span class="sc">&gt;=</span><span class="dv">75</span>,age<span class="dv">-75</span>,<span class="dv">0</span>)</span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>agesp2 <span class="ot">=</span> <span class="fu">ifelse</span>(age<span class="sc">&gt;=</span><span class="dv">85</span>,age<span class="dv">-85</span>,<span class="dv">0</span>)</span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>age65 <span class="ot">=</span> age<span class="dv">-65</span></span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>AGE <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">31</span>),age65,agesp1,agesp2)</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>expectDiff<span class="ot">=</span><span class="fu">t</span>(AGE)<span class="sc">%*%</span><span class="fu">coefficients</span>(mlr.fit)[<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a>V <span class="ot">=</span> <span class="fu">vcov</span>(mlr.fit)[<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a>V.big <span class="ot">=</span> <span class="fu">t</span>(AGE)<span class="sc">%*%</span>V<span class="sc">%*%</span>AGE</span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>var <span class="ot">=</span> <span class="fu">diag</span>(V.big)</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>diffage <span class="ot">=</span> <span class="fu">data.frame</span>(age,</span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a>          <span class="at">expectDiff =</span> expectDiff<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>          <span class="at">std =</span> <span class="fu">sqrt</span>(var),</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>          <span class="at">min =</span> (expectDiff<span class="fl">-1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(var))<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>          <span class="at">max =</span>(expectDiff<span class="fl">+1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(var))<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diffage,<span class="fu">aes</span>(<span class="at">x =</span> age,<span class="at">y =</span> expectDiff)) <span class="sc">+</span></span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> diffage) <span class="sc">+</span></span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,<span class="at">col =</span> <span class="st">'blue'</span>,<span class="at">data=</span> diffage, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>min,<span class="at">ymax =</span>max),<span class="at">alpha =</span><span class="fl">0.5</span>,<span class="at">data=</span> diffage) <span class="sc">+</span></span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">12</span>,<span class="dv">1</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">65</span>,<span class="dv">95</span>,<span class="dv">5</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">65</span>,<span class="dv">95</span>)) <span class="sc">+</span></span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Difference (Female - Male, in $1000s)"</span>, <span class="at">x =</span> <span class="st">"Age (in years)"</span>) <span class="sc">+</span></span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() </span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 3: linear regression model with age</span></span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a>**Further, we want to test the null hypothesis that on average, males and females use the same quantity of medical services; i.e. are the mean expenditures at any age the same for males and females?**</span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a>H_0: &amp; \ \beta_4 = \beta_5 = \beta_6 = \beta_7 = 0 <span class="sc">\\</span></span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a>H_a: &amp; \ \text{at least one of } \beta_4, \beta_5, \beta_6, \text{ or } \beta_7 \text{ is not zero.}</span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a>**We can fit a reduced a model with only age-related predictors:**</span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a>Y_i = &amp; \ \beta_0 + \beta_1(age_i-65) + \beta_2(age_i-75)^+ + \beta_3(age_i-85)^+ + \epsilon_i \text{ , } <span class="sc">\\</span></span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a>      &amp; \ \text{where } \epsilon_i \sim N(0, \sigma^2)</span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a>mlr.fit0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(totalexp <span class="sc">~</span> agem65 <span class="sc">+</span> age_sp1 <span class="sc">+</span> age_sp2, <span class="at">data =</span> d)</span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a>tidy_mlr.fit0 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mlr.fit0)</span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a>tidy_mlr.fit0 <span class="ot">&lt;-</span> tidy_mlr.fit0[, <span class="fu">c</span>(<span class="st">"term"</span>, <span class="st">"estimate"</span>, <span class="st">"std.error"</span>, <span class="st">"statistic"</span>, <span class="st">"p.value"</span>)]</span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tidy_mlr.fit0, <span class="at">caption =</span> <span class="st">"Linear model coefficients of the reduced model"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">format =</span> <span class="st">"html"</span>, </span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Term"</span>, <span class="st">"Estimate"</span>, <span class="st">"Std. Error"</span>, <span class="st">"t value"</span>, <span class="st">"Pr(&gt;|t|)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F, <span class="at">position =</span> <span class="st">"left"</span>)</span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a><span class="co"># likelihood ratio test</span></span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(mlr.fit0, mlr.fit)</span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a>**A likelihood ratio test showed that the reduced model and the full model are not significantly different from each other ($p=0.2715$), indicating we fail to reject the null hypothesis and that the mean expenditures at any age are the same for males and females.**</span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a><span class="fu">### Results and Summary</span></span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a>In this example analysis, we utilized the data from 1987 National Medical Expenditure Survey (NMES) to examine the annual change of total medical expenditure for older people (from age 65 to 94) and its relationship with sex. We first fitted a linear spline regression model on total medical expenditure with age and sex and the interaction between the two factors. The regression result showed that none of the predictors of age and sex were significant except for the intercept, even though the scatter plot indicated some disparity between male and female at age 65 - 75 and above 85 (Figure 4). The 95% confidence interval for estimated difference in average expenditures comparing men and women as a function of age suggested no significant difference due to sex (Figure 5). We performed a likelihood ratio test to compare the full model with a reduced model excluding the factor sex and concluded that we failed to reject the null hypothesis that men and women have the same quantity of medical expenditures at any age.</span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true" tabindex="-1"></a>::: {.callout-important collapse="false"}</span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true" tabindex="-1"></a>This analysis is based on the assumption that residuals are normally distributed and homoscedastic, which requires further validation. If such assumptions are violated, standard errors and confidence intervals are likely biased, and a more appropriate analysis approach need to be adapted.</span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true" tabindex="-1"></a>However, more recent analyses indeed demonstrated noticeable discrepancy between female and male in healthcare expenses. The Kaiser Family Foundation analysis of CMS Medicare Current Beneficiary Survey 2009 Cost and Use file <span class="co">[</span><span class="ot">@KFF</span><span class="co">]</span> showed that out-of-pocket spending by elder female is higher than that by male while more proportion of women had annual incomes below \$20,000 compared to men (Figure 6). Thus, it is important for health policymakers to consider various factors regarding medical expenditures, such as socioeconomic status and etc., before coming to any conclusions.</span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-235"><a href="#cb11-235" aria-hidden="true" tabindex="-1"></a><span class="al">![Figure 6: Income and out-of-pocket expenses among older medicare beneficiaries, by gender and age](images/healthcare_2009.webp)</span>{width="500px"}</span>
<span id="cb11-236"><a href="#cb11-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-237"><a href="#cb11-237" aria-hidden="true" tabindex="-1"></a><span class="fu">### Functions</span></span>
<span id="cb11-238"><a href="#cb11-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-239"><a href="#cb11-239" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`dplyr`</span>: <span class="in">`select()`</span>, <span class="in">`filter()`</span>, <span class="in">`mutate()`</span>, <span class="in">`group_by()`</span>,<span class="in">`summarise()`</span></span>
<span id="cb11-240"><a href="#cb11-240" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`ggplot2`</span>: <span class="in">`geom_point()`</span>, <span class="in">`geom_jitter`</span>, <span class="in">`geom_line`</span>, <span class="in">`geom_hline`</span>, <span class="in">`geom_ribbon`</span></span>
<span id="cb11-241"><a href="#cb11-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-242"><a href="#cb11-242" aria-hidden="true" tabindex="-1"></a>::: {#bibliography}</span>
<span id="cb11-243"><a href="#cb11-243" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>